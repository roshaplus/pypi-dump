{
  "info": {
    "author": "Angelo Failla",
    "author_email": "pallotron@fb.com",
    "bugtrack_url": "",
    "classifiers": [
      "Development Status :: 5 - Production/Stable",
      "Intended Audience :: Developers",
      "License :: OSI Approved :: BSD License",
      "Operating System :: POSIX :: Linux",
      "Programming Language :: Python :: 3.5",
      "Programming Language :: Python :: 3 :: Only",
      "Topic :: Software Development :: Libraries :: Application Frameworks",
      "Topic :: System :: Boot",
      "Topic :: Utilities"
    ],
    "description": "[![Build Status](https://travis-ci.org/facebook/fbtftp.svg?branch=master)](https://travis-ci.org/facebook/fbtftp)\r\n\r\n# What is fbtftp?\r\n\r\n`fbtftp` is Facebook's implementation of a dynamic TFTP server framework. It\r\nlets you create custom TFTP servers and wrap your own logic into it in a very\r\nsimple manner.\r\nFacebook currently uses it in production, and it's deployed at global scale\r\nacross all of our data centers.\r\n\r\n# Why did you do that?\r\n\r\nWe love to use existing open source software and to contribute upstream, but\r\nsometimes it's just not enough at our scale. We ended up writing our own tftp\r\nframework and decided to open source it.\r\n\r\n`fbtftp` was born from the need of having an easy-to-configure and\r\neasy-to-expand TFTP server, that would work at large scale. The standard\r\n`in.tftpd` is a 20+ years old piece of software written in C that is very\r\ndifficult to extend.\r\n\r\n`fbtftp` is written in `python3` and lets you plug your own logic to:\r\n\r\n* publish per session and server wide statistics to your infrastructure\r\n* define how response data is built:\r\n  * can be a file from disk;\r\n  * can be a file created dynamically;\r\n  * you name it!\r\n\r\n# How do you use `fbtftp` at Facebook?\r\n\r\nWe created our own Facebook-specific server based on the framework to:\r\n\r\n* stream static files (initrd and kernels) from our http repositories (no need\r\n  to fill your tftp root directory with files);\r\n* generate grub2 per-machine configuration dynamically (no need to copy grub2\r\n  configuration files on disk);\r\n* publish per-server and per-connection statistics to our internal monitoring\r\n  systems;\r\n* deployment is easy and \"container-ready\", just copy the application somewhere,\r\n  start it and you are done.\r\n\r\n# Is it better than the other TFTP servers?\r\n\r\nIt depends on your needs! `fbtftp` is written in Python 3 using a\r\nmultiprocessing model; its primary focus is not speed, but flexibility and\r\nscalability. Yet it is fast enough at our datacenter scale :)\r\nIt is well-suited for large installations where scalability and custom features\r\nare needed.\r\n\r\n# What does it support?\r\n\r\nThe framework implements the following RFCs:\r\n\r\n* [RFC 1350](https://tools.ietf.org/html/rfc1350) (the main TFTP specification)\r\n* [RFC 2347](https://tools.ietf.org/html/rfc2347) (Option Extension)\r\n* [RFC 2348](https://tools.ietf.org/html/rfc2348) (Blocksize option)\r\n* [RFC 2349](https://tools.ietf.org/html/rfc2349) (Timeout Interval and Transfer\r\n  Size Options).\r\n\r\nNote that the server framework only support RRQs (read only) operations.\r\n(Who uses WRQ TFTP requests in 2016? :P)\r\n\r\n# How does it work?\r\n\r\nAll you need to do is understanding three classes and two callback functions,\r\nand you are good to go:\r\n\r\n* `BaseServer`: This class implements the process which deals with accepting new\r\n  requests on the UDP port provided. Default TFTP parameters like timeout, port\r\n  number and number of retries can be passed. This class doesn't have to be used\r\n  directly, you must inherit from it and override `get_handler()` method to\r\n  return an instance of `BaseHandler`.\r\n  The class accepts a `server_stats_callback`, more about it below. the callback\r\n  is not re-entrant, if you need this you have to implement your own locking\r\n  logic. This callback is executed periodically and you can use it to publish\r\n  server level stats to your monitoring infrastructure. A series of predefined\r\n  counters are provided. Refer to the class documentation to find out more.\r\n\r\n* `BaseHandler`: This class deals with talking to a single client. This class\r\n  lives into its separate process, process which is spawned by the `BaserServer`\r\n  class, which will make sure to reap the child properly when the session is\r\n  over. Do not use this class as is, instead inherit from it and override the `get_response_data()` method. Such method must return an instance of a subclass of `ResponseData`.\r\n\r\n* `ResponseData`: it's a file-like class that implements `read(num_bytes)`,\r\n  `size()` and `close()`. As the previous two classes you'll have to inherit\r\n  from this and implement those methods. This class basically let you define how\r\n  to return the actual data\r\n\r\n* `server_stats_callback`: function that is called periodically (every 60\r\n  seconds by default). The callback is not re-entrant, if you need this you have\r\n  to implement your own locking logic. This callback is executed periodically\r\n  and you can use it to publish server level stats to your monitoring\r\n  infrastructure. A series of predefined counters are provided.\r\n  Refer to the class documentation to find out more.\r\n\r\n* `session_stats_callback`: function that is called when a client session is\r\n  over.\r\n\r\n# Requirements\r\n\r\n* Linux (or any system that supports [`epoll`](http://linux.die.net/man/4/epoll))\r\n* Python 3.x\r\n\r\n# Installation\r\n\r\n`fbtftp` is distributed with the standard `distutils` package, so you can build\r\nit with:\r\n\r\n```\r\npython setup.py build\r\n```\r\n\r\nand install it with:\r\n\r\n```\r\npython setup.py install\r\n```\r\n\r\nBe sure to run as root if you want to install `fbtftp` system wide. You can also\r\nuse a `virtualenv`, or install it as user by running:\r\n\r\n```\r\npython setup.py install --user\r\n```\r\n\r\n# Example\r\n\r\nWriting your own server is simple. Let's take a look at how to write a simple\r\nserver that serves files from disk:\r\n\r\n```python\r\nfrom fbtftp.base_handler import BaseHandler\r\nfrom fbtftp.base_handler import ResponseData\r\nfrom fbtftp.base_server import BaseServer\r\n\r\nimport os\r\n\r\nclass FileResponseData(ResponseData):\r\n    def __init__(self, path):\r\n        self._size = os.stat(path).st_size\r\n        self._reader = open(path, 'rb')\r\n\r\n    def read(self, n):\r\n        return self._reader.read(n)\r\n\r\n    def size(self):\r\n        return self._size\r\n\r\n    def close(self):\r\n        self._reader.close()\r\n\r\ndef print_session_stats(stats):\r\n    print(stats)\r\n\r\ndef print_server_stats(stats):\r\n    counters = stats.get_and_reset_all_counters()\r\n    print('Server stats - every {} seconds'.format(stats.interval))\r\n    print(counters)\r\n\r\nclass StaticHandler(BaseHandler):\r\n    def __init__(self, server_addr, peer, path, options, root, stats_callback):\r\n        self._root = root\r\n        super().__init__(server_addr, peer, path, options, stats_callback)\r\n\r\n    def get_response_data(self):\r\n        return FileResponseData(os.path.join(self._root, self._path))\r\n\r\nclass StaticServer(BaseServer):\r\n    def __init__(self, address, port, retries, timeout, root,\r\n                 handler_stats_callback, server_stats_callback=None):\r\n        self._root = root\r\n        self._handler_stats_callback = handler_stats_callback\r\n        super().__init__(address, port, retries, timeout, server_stats_callback)\r\n\r\n    def get_handler(self, server_addr, peer, path, options):\r\n        return StaticHandler(\r\n            server_addr, peer, path, options, self._root,\r\n            self._handler_stats_callback)\r\n\r\ndef main():\r\n    server = StaticServer(ip='', port='1069', retries=3, timeout=5,\r\n                          root='/var/tftproot', print_session_stats,\r\n                          print_server_stats)\r\n    try:\r\n        server.run()\r\n    except KeyboardInterrupt:\r\n        server.close()\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n```\r\n\r\n# Who wrote it?\r\n\r\n`fbtftp` was created by Angelo Failla <pallotron@fb.com> at Facebook Ireland.\r\n\r\nOther honorable contributors:\r\n* Marcin Wyszynski (@marcinwyszynski)\r\n* Andrea Barberio <barberio@fb.com>",
    "docs_url": null,
    "download_url": "UNKNOWN",
    "downloads": {
      "last_day": 0,
      "last_month": 0,
      "last_week": 0
    },
    "home_page": "https://www.github.com/facebook/fbtftp",
    "keywords": "tftp daemon infrastructure provisioning netboot",
    "license": "BSD",
    "maintainer": "",
    "maintainer_email": "",
    "name": "fbtftp",
    "platform": "UNKNOWN",
    "project_url": "https://pypi.org/project/fbtftp/",
    "release_url": "https://pypi.org/project/fbtftp/0.1/",
    "requires_python": null,
    "summary": "A python3 framework to build dynamic TFTP servers",
    "version": "0.1"
  },
  "releases": {
    "0.1": [
      {
        "comment_text": "",
        "digests": {
          "md5": "567720601f433d5628162c57d5e613df",
          "sha256": "d51093985327c7aac9f1a7c50d3655f9dd9ff8af316fc03668efce94b12490e9"
        },
        "downloads": 498,
        "filename": "fbtftp-0.1.tar.gz",
        "has_sig": false,
        "md5_digest": "567720601f433d5628162c57d5e613df",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 22281,
        "upload_time": "2016-05-27T12:07:11",
        "url": "https://files.pythonhosted.org/packages/ca/44/d08df739facf3ec56ad358775050053dc9d73f915c04cf6bdf044ba4e7c2/fbtftp-0.1.tar.gz"
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "md5": "567720601f433d5628162c57d5e613df",
        "sha256": "d51093985327c7aac9f1a7c50d3655f9dd9ff8af316fc03668efce94b12490e9"
      },
      "downloads": 498,
      "filename": "fbtftp-0.1.tar.gz",
      "has_sig": false,
      "md5_digest": "567720601f433d5628162c57d5e613df",
      "packagetype": "sdist",
      "python_version": "source",
      "size": 22281,
      "upload_time": "2016-05-27T12:07:11",
      "url": "https://files.pythonhosted.org/packages/ca/44/d08df739facf3ec56ad358775050053dc9d73f915c04cf6bdf044ba4e7c2/fbtftp-0.1.tar.gz"
    }
  ]
}