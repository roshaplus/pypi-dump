{
  "info": {
    "author": "Scott Sanders",
    "author_email": "scott@jssjr.com",
    "bugtrack_url": null,
    "classifiers": [],
    "description": "# Carbonate\n\n> \"Pop bottles.\" *-- Birdman*\n\n[![Codacy Badge](https://api.codacy.com/project/badge/Grade/99e1654102b74d82a63505145334e7ed)](https://www.codacy.com/app/graphite-project/carbonate?utm_source=github.com&utm_medium=referral&utm_content=graphite-project/carbonate&utm_campaign=badger)\n[![Build Status](https://travis-ci.org/graphite-project/carbonate.svg?branch=master)](https://travis-ci.org/graphite-project/carbonate)\n[![FOSSA Status](https://app.fossa.io/api/projects/git%2Bhttps%3A%2F%2Fgithub.com%2Fgraphite-project%2Fcarbonate.svg?type=shield)](https://app.fossa.io/projects/git%2Bhttps%3A%2F%2Fgithub.com%2Fgraphite-project%2Fcarbonate?ref=badge_shield)\n\nGraphite clusters are pretty cool. Here are some primitive tools to help you manage your graphite clusters.\n\nAll of the tools support two common arguments; the path to a config file, and the name of the cluster. Using these tools alongside a config file that describes your graphite clusters you can build up scripts to manage your metrics. Some of the tools could easily be replaced with one-liners in shell, but exist here for convenience and readability. The goal is to provide fast, predictable utilities that can easily be composed into more advanced tooling.\n\n## Install\n[Carbonate is available from Python official third party repository](https://pypi.python.org/pypi/carbonate/0.2.1) (aka PyPi) and as such can be installed via regular Python package managers.\nNote that you might have to install a python package manager (e.g. apt-get install python-setuptools on a ubuntu host)\n\n```\npip install carbonate\n```\n## The Config\n\nCarbonate expects a configuration file that defines the clusters in your environment. The default config file is located at `/opt/graphite/conf/carbonate.conf` or can be provided on the command line. The default cluster is named 'main'. Both defaults can be overridden by setting in the environment `CARBONATE_CONFIG` and `CARBONATE_CLUSTER` respectively.\n\n```\n[main]\nDESTINATIONS = 192.168.9.13:2004:carbon01, 192.168.9.15:2004:carbon02, 192.168.6.20:2004:carbon03\nREPLICATION_FACTOR = 2\nSSH_USER = carbon\n\n[fnv]\nDESTINATIONS = 192.168.9.13:2004:ba603c36342304ed77953f84ac4d357b, 192.168.9.15:2004:5dd63865534f84899c6e5594dba6749a, 192.168.6.20:2004:866a18b81f2dc4649517a1df13e26f28\nREPLICATION_FACTOR = 2\nSSH_USER = carbonate\nHASHING_TYPE = fnv1a_ch\n```\n\nYou should take care to match the list of destination IPs or hostnames to the nodes in your cluster. Though its worth noting that the ports and labels are currently not used by carbonate. Order is important because of how the consistent hash ring is created.\n\nThe replication factor should match the replication factor for the cluster.\n\nAlso, you can choose to provide a SSH user that will be used when carbonate requires connecting to another node in the cluster to perform an operation. If this is not provided, then the current user executing the command will be chosen.\n\nFinally, you can provide HASHING_TYPE of your cluster. Default is `carbon_ch`, also `fnv1a_ch` is supported. Please note that for using `fnv1a_ch` hashing you need `carbon` 1.0.2 or newer installed. (*experimental feature*)\n\n## The Tools\n\n### carbon-hosts\n\n```\nusage: carbon-hosts [-h] [-c CONFIG_FILE] [-C CLUSTER]\n\nReturn the addresses for all nodes in a cluster\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -c CONFIG_FILE, --config-file CONFIG_FILE\n                        Config file to use (default:\n                        /opt/graphite/conf/carbonate.conf)\n  -C CLUSTER, --cluster CLUSTER\n                        Cluster name (default: main)\n```\n\n### carbon-lookup\n\n```\nusage: carbon-lookup [-h] [-c CONFIG_FILE] [-C CLUSTER] [-s] METRIC\n\nLookup where a metric lives in a carbon cluster\n\npositional arguments:\n  METRIC                Full metric name to search for\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -c CONFIG_FILE, --config-file CONFIG_FILE\n                        Config file to use (default:\n                        /opt/graphite/conf/carbonate.conf)\n  -C CLUSTER, --cluster CLUSTER\n                        Cluster name (default: main)\n  -s, --short           Only display the address, without port and cluster\n                        name (default: False)\n```\n\n### carbon-list\n\n```\nusage: carbon-list [-h] [-c CONFIG_FILE] [-C CLUSTER] [-d STORAGE_DIR]\n\nList the metrics this carbon node contains\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -c CONFIG_FILE, --config-file CONFIG_FILE\n                        Config file to use (default:\n                        /opt/graphite/conf/carbonate.conf)\n  -C CLUSTER, --cluster CLUSTER\n                        Cluster name (default: main)\n  -d STORAGE_DIR, --storage-dir STORAGE_DIR\n                        Storage dir (default: /opt/graphite/storage/whisper)\n```\n\n### carbon-sieve\n\n```\nusage: carbon-sieve [-h] [-c CONFIG_FILE] [-C CLUSTER] [-f METRICS_FILE]\n                    [-n NODE] [-I]\n\nGiven a list of metrics, output those that belong to a node\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -c CONFIG_FILE, --config-file CONFIG_FILE\n                        Config file to use (default:\n                        /opt/graphite/conf/carbonate.conf)\n  -C CLUSTER, --cluster CLUSTER\n                        Cluster name (default: main)\n  -f METRICS_FILE, --metrics-file METRICS_FILE\n                        File containing metric names to filter, or '-' to read\n                        from STDIN (default: -)\n  -n NODE, --node NODE  Filter for metrics belonging to this node (default:\n                        self)\n  -I, --invert          Invert the sieve, match metrics that do NOT belong to\n                        a node (default: False)\n```\n\n### carbon-sync\n\n```\nusage: carbon-sync [-h] [-c CONFIG_FILE] [-C CLUSTER] [-f METRICS_FILE] -s\n                   SOURCE_NODE [-d STORAGE_DIR] [-b BATCH_SIZE]\n                   [--source-storage-dir SOURCE_STORAGE_DIR]\n                   [--rsync-options [RSYNC_OPTIONS [RSYNC_OPTIONS ...]]]\n\nSync local metrics using remote nodes in the cluster\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -c CONFIG_FILE, --config-file CONFIG_FILE\n                        Config file to use (default:\n                        /opt/graphite/conf/carbonate.conf)\n  -C CLUSTER, --cluster CLUSTER\n                        Cluster name (default: main)\n  -f METRICS_FILE, --metrics-file METRICS_FILE\n                        File containing metric names to filter, or '-' to read\n                        from STDIN (default: -)\n  -s SOURCE_NODE, --source-node SOURCE_NODE\n                        Override the source for metrics data (default: None)\n  -d STORAGE_DIR, --storage-dir STORAGE_DIR\n                        Storage dir (default: /opt/graphite/storage/whisper)\n  -b BATCH_SIZE, --batch-size BATCH_SIZE\n                        Batch size for the rsync job (default: 1000)\n  --source-storage-dir SOURCE_STORAGE_DIR\n                        Source storage dir (default:\n                        /opt/graphite/storage/whisper)\n  --rsync-options [RSYNC_OPTIONS [RSYNC_OPTIONS ...]]\n                        Pass option(s) to rsync (default: -azpS)\n```\n\n### carbon-path\n\n```\nusage: carbon-path [-h] [-c CONFIG_FILE] [-C CLUSTER] [-f METRICS_FILE] [-r]\n                   [-p] [-d STORAGE_DIR]\n\nTransform metric paths to (or from) filesystem paths\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -c CONFIG_FILE, --config-file CONFIG_FILE\n                        Config file to use (default:\n                        /opt/graphite/conf/carbonate.conf)\n  -C CLUSTER, --cluster CLUSTER\n                        Cluster name (default: main)\n  -f METRICS_FILE, --metrics-file METRICS_FILE\n                        File containing metric names to transform to file\n                        paths, or '-' to read from STDIN (default: -)\n  -r, --reverse         Transform from file paths to metric paths (default:\n                        False)\n  -p, --prepend         Prepend storage dir to file paths (default: False)\n  -d STORAGE_DIR, --storage-dir STORAGE_DIR\n                        Whisper storage directory to prepend when -p given\n                        (default: /opt/graphite/storage/whisper)\n```\n\n### carbon-stale\n\n```\nusage: carbon-stale [-h] [-c CONFIG_FILE] [-C CLUSTER] [-f METRICS_FILE] [-r]\n                    [-d STORAGE_DIR] [-l HOURS] [-o HOURS] [-w] [-p]\n\nFind and list potentially stale metrics.\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -c CONFIG_FILE, --config-file CONFIG_FILE\n                        Config file to use (default:\n                        /opt/graphite/conf/carbonate.conf)\n  -C CLUSTER, --cluster CLUSTER\n                        Cluster name (default: main)\n  -f METRICS_FILE, --metrics-file METRICS_FILE\n                        File containing metric names to transform to file\n                        paths, or '-' to read from STDIN (default: -)\n  -r, --reverse         Output metrics which are not stale instead (default:\n                        False)\n  -d STORAGE_DIR, --storage-dir STORAGE_DIR\n                        Whisper storage directory to prepend when -p given\n                        (default: /opt/graphite/storage/whisper)\n  -l HOURS, --limit HOURS\n                        Definition of staleness, in hours (default: 24)\n  -o HOURS, --offset HOURS\n                        Use a whisper data window ending HOURS ago (implies\n                        -w) (default: 0)\n  -w, --whisper         Use whisper data instead of filesystem stat() call\n                        (default: False)\n  -p, --paths           Print filesystem paths instead of metric names\n                        (default: False)\n```\n\n### whisper-aggregate\n\n```\nusage: whisper-aggregate [-h] [-f METRICS_FILE] [-d STORAGE_DIR]\n\nSet aggregation for whisper-backed metrics this carbon instance contains\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -f METRICS_FILE, --metrics-file METRICS_FILE\n                        File containing metric names and aggregation modes, or\n                        '-' to read from STDIN (default: -)\n  -d STORAGE_DIR, --storage-dir STORAGE_DIR\n                        Whisper storage directory (default:\n                        /opt/graphite/storage/whisper)\n```\n\n### whisper-fill\n\n```\nusage: whisper-fill [-h] SRC DST\n\nBackfill datapoints from one whisper file into another\n\npositional arguments:\n  SRC         Whisper source file\n  DST         Whisper destination file\n\noptional arguments:\n  -h, --help  show this help message and exit\n```\n\n## Example usage\n\n### Resync a node in a cluster\n\n```\n#!/bin/sh\n#\n# Resync a node from other nodes in the cluster\n#\n\nLOCAL_IP=\"$1\"\n\nfor h in $(carbon-hosts) ; do\n  (\n    ssh $h -- carbon-list |\n    carbon-sieve -n $LOCAL_IP |\n    carbon-sync -s $h\n  ) &\ndone\n```\n\n### Rebalance a cluster\n\n```\n#!/bin/sh\n#\n# Rebalance a cluster from one size to another. Remember to cleanup metrics\n# that no longer belong when all nodes are rebalanced!\n#\n\nLOCAL_IP=\"$1\"\nOLD_CLUSTER=\"old\"\nNEW_CLUSTER=\"main\"\n\nfor h in $(carbon-hosts -C \"$OLD_CLUSTER\") ; do\n  ssh $h -- carbon-list |\n  carbon-sieve -C \"$NEW_CLUSTER\" -n $LOCAL_IP |\n  carbon-sync -s $h\ndone\n```\n\n### List metrics that don't belong\n\n```\n#!/bin/sh\n#\n# List metrics from disk that don't belong\n#\n\nLOCAL_IP=\"$1\"\n\ncarbon-list | carbon-sieve -I -n $LOCAL_IP\n```\n\n### Listing metrics that have stopped updating\n\nMetrics with whisper data that is entirely blank for the last 2 hours (perhaps\nuseful if you suspect issues with fs timestamps or carbon clients writing in 'the\nfuture'):\n\n```\ncarbon-list | carbon-stale --whisper --limit=2\n```\n\nMetrics whose metrics files appear untouched for 48 hours or more (functionally\nidentical to `find /your/data/dir -type f -mtime +2`):\n\n```\ncarbon-list | carbon-stale --limit=48\n```\n\nMore interesting is if you use ``carbon-stale``, then sieve to identify stale\nmetrics that don't belong here (vs un-stale metrics that *do* belong here but\nare misreported in carbon-sieve due to things like doubled-up periods in metric\npaths due to broken collectors. It's a thing.)\n\n```\ncarbon-list | carbon-stale --limit=48 | carbon-sieve -I -n $LOCAL_IP\n```\n\nTo print file paths for use with e.g. `xargs rm` or whatnot, use `-p`:\n\n```\ncarbon-list | carbon-stale -p | xargs -n 100 rm\n```\n\n\n# License\n\nThe code is available under the MIT license.\n\n\n\n",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": 0,
      "last_month": 0,
      "last_week": 0
    },
    "home_page": "https://github.com/jssjr/carbonate",
    "keywords": "graphite carbon",
    "license": "MIT",
    "maintainer": "",
    "maintainer_email": "",
    "name": "carbonate",
    "platform": "",
    "project_url": "https://pypi.org/project/carbonate/",
    "release_url": "https://pypi.org/project/carbonate/1.0.2/",
    "requires_dist": [],
    "requires_python": "",
    "summary": "Tools for managing federated carbon clusters.",
    "version": "1.0.2"
  },
  "releases": {
    "0.2.0": [],
    "0.2.1": [
      {
        "comment_text": "",
        "digests": {
          "md5": "43dd0f874ffed3b4b8d5e4fbcd088e88",
          "sha256": "127db79aa6905e48ef7c1ca70ddb75a046ac12ae159b191b9a18ad5b682a326d"
        },
        "downloads": 3095,
        "filename": "carbonate-0.2.1.tar.gz",
        "has_sig": false,
        "md5_digest": "43dd0f874ffed3b4b8d5e4fbcd088e88",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 9692,
        "upload_time": "2014-02-01T22:08:39",
        "url": "https://files.pythonhosted.org/packages/d7/af/06c957f4002c4e43d6afe4983b8947c53087d9eae3961f3a79ff00837175/carbonate-0.2.1.tar.gz"
      }
    ],
    "0.2.2": [
      {
        "comment_text": "",
        "digests": {
          "md5": "775009d039b850b8e00db9377aa5ab73",
          "sha256": "33e8801d7a8dc5f0c114b8d8b5cfa06b981f8188fea37fb231eec33dc83dfcec"
        },
        "downloads": 8316,
        "filename": "carbonate-0.2.2.tar.gz",
        "has_sig": false,
        "md5_digest": "775009d039b850b8e00db9377aa5ab73",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 11133,
        "upload_time": "2014-10-15T15:05:18",
        "url": "https://files.pythonhosted.org/packages/8c/5b/791cc4ee3dd7dceeb0922ed8dc5548c259c7e107251251432d267d002ffe/carbonate-0.2.2.tar.gz"
      }
    ],
    "0.2.3": [
      {
        "comment_text": "",
        "digests": {
          "md5": "63fd99d690832070436cdf61f947d565",
          "sha256": "cd3ee1a178491cecd6a54328826d4dd413f0047badc604754923cb973abeccb7"
        },
        "downloads": 64,
        "filename": "carbonate-0.2.3.tar.gz",
        "has_sig": false,
        "md5_digest": "63fd99d690832070436cdf61f947d565",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 13894,
        "upload_time": "2017-02-13T16:39:44",
        "url": "https://files.pythonhosted.org/packages/8e/ea/9af4bac14f415dd77eed252a3195530fc39fe3627dc6b7c101cd114c2476/carbonate-0.2.3.tar.gz"
      }
    ],
    "1.0.0": [
      {
        "comment_text": "",
        "digests": {
          "md5": "07af8a6afe8211e7322693163f7734a1",
          "sha256": "3c905e9c02cf5f005011097bccb81681d348df99fc0c5518b0396d81ab1faf76"
        },
        "downloads": 0,
        "filename": "carbonate-1.0.0.tar.gz",
        "has_sig": false,
        "md5_digest": "07af8a6afe8211e7322693163f7734a1",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 13882,
        "upload_time": "2017-04-11T21:32:59",
        "url": "https://files.pythonhosted.org/packages/8e/44/9bca63df90b9302265de385fd44001dab1b75cef5e01645e3573eaab0cde/carbonate-1.0.0.tar.gz"
      }
    ],
    "1.0.1": [
      {
        "comment_text": "",
        "digests": {
          "md5": "cd9fc16ce1b4c92f857135c1671b5465",
          "sha256": "fd4dc5d0e337420da05cf3de88ac876d36d44201dd09f208bda23759bdf5f076"
        },
        "downloads": 0,
        "filename": "carbonate-1.0.1.tar.gz",
        "has_sig": false,
        "md5_digest": "cd9fc16ce1b4c92f857135c1671b5465",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 13893,
        "upload_time": "2017-04-23T17:25:00",
        "url": "https://files.pythonhosted.org/packages/90/08/d8aa7ca3c0d7e35b5a04e20e19583145879f2b924371b1bf9fb39b2df026/carbonate-1.0.1.tar.gz"
      }
    ],
    "1.0.2": [
      {
        "comment_text": "",
        "digests": {
          "md5": "dd023519df2a9e1b488ee834ae85ebf6",
          "sha256": "784e9cb7424fd3f9954a2f779735ad4e571a090849ad850d05709ee1ba3b375e"
        },
        "downloads": 0,
        "filename": "carbonate-1.0.2.tar.gz",
        "has_sig": false,
        "md5_digest": "dd023519df2a9e1b488ee834ae85ebf6",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 14269,
        "upload_time": "2017-07-11T21:35:06",
        "url": "https://files.pythonhosted.org/packages/3f/86/fdf90cbbb2e190392bbf214b2357162965e002fadf7e1664811d95c88952/carbonate-1.0.2.tar.gz"
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "md5": "dd023519df2a9e1b488ee834ae85ebf6",
        "sha256": "784e9cb7424fd3f9954a2f779735ad4e571a090849ad850d05709ee1ba3b375e"
      },
      "downloads": 0,
      "filename": "carbonate-1.0.2.tar.gz",
      "has_sig": false,
      "md5_digest": "dd023519df2a9e1b488ee834ae85ebf6",
      "packagetype": "sdist",
      "python_version": "source",
      "size": 14269,
      "upload_time": "2017-07-11T21:35:06",
      "url": "https://files.pythonhosted.org/packages/3f/86/fdf90cbbb2e190392bbf214b2357162965e002fadf7e1664811d95c88952/carbonate-1.0.2.tar.gz"
    }
  ]
}