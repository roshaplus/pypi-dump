{
  "info": {
    "author": "Jonathan Tushman",
    "author_email": "jonathan@zefr.com",
    "bugtrack_url": null,
    "classifiers": [
      "Intended Audience :: Developers",
      "License :: OSI Approved :: MIT License",
      "Programming Language :: Python :: 2.7",
      "Programming Language :: Python :: 3"
    ],
    "description": ".. -*-restructuredtext-*-\n\nmonarch\n=======\n\n|Build Status|\n\n.. |Build Status| image:: https://travis-ci.org/jtushman/monarch.svg?branch=master\n    :target: https://travis-ci.org/jtushman/monarch\n\n\nThe Concept\n-----------\n\n\"migrations should happen naturally\"\n\n**monarch** is a mongo utility belt that helps developers and admins deal with common admin use-cases.  The main use-case\nthat this library was built for was _migrations_ but it does a bunch or other useful things like makes it easy to\nbackup, restore, and copy environments between one another.\n\nIt has been very helpful for our teams -- and hopefully you guys can find it useful as well.\n\n\nThe Interface\n-------------\n\nMigrations\n~~~~~~~~~~\nSimple Migration Framework\n\n``generate <migration_name>``\n    Generates a new migration template.  In this template you write the necessary code to perform your migration\n\n``list_migrations <env_name>``\n    Lists all of the migrations and there current status\n\n``migrate <env_name>``\n    Runs all pending migration on the given environment.  Normally you will use `copy_db` to move the production environment\n    locally and test the migrations locally first before doing on production\n\n``migrate_one <migration_name> <env_name>``\n    Run a specific migration -- no matter its status.  Helpful for rapid test iteration\n\n\nEnvironment Management\n~~~~~~~~~~~~~~~~~~~~~~\nUtilities for moving databases between environments.  With support for backup/restore locally and to s3\n\n``init``\n    Initializes monarch for your project\n\n``list_environments``\n    Lists the environments under management\n\n``backup <env name>``\n    Backs ups a given database.  You can backup to your local file system or to a Amazon S3 bucket\n    Make sure you have BACKUPS configured in your migrations/settings.py file\n    It will dump your database and compress it and give it a unquie name\n\n``restore  <backup_name>:<env_name>``\n    Restore a backup into the provided environment.  It will trucacte the database before the import\n\n``list_backups``\n    Lists the available backups\n\n``copy_db <from_env>:<to_env>``\n    Copies one database into another database\n\n    It will make an archive of the \"From\" database and then truncate the \"To\" database and restore that archive into the\n    \"To\" database\n\n    This is most useful for copying the production database locally to test migrations before doing it for reals\n\n\nPartial Copies and Backups\n~~~~~~~~~~~~~~~~~~~~~~~~~\nAs your database grows, it is often useful to copy only a subset of your data.  For this we introduce the concept\nof a QuerySet.  You can use these to define the subset of data you would like to bring over.\n\n``generate_query_set``\n   Generates a new query_set template.  In this template you write the necessary code to perform your query_set\n\n\nA queryset can look like:\n\n.. code:: python\n\n    from monarch import QuerySet\n    from click import echo\n    \n    class AwesomeDogsQuerySet(QuerySet):\n    \n        def run(self):\n    \n            awesome_dogs = self.database.dogs.find({\"type\": \"Awesome\"})\n            awesome_dog_ids = [dog['_id'] for dog in awesome_dogs]\n            echo(\"awesome dog ids: {}\".format(awesome_dog_ids))\n    \n            self.dump_collection('dogs', {\"_id\": {\"$in\": awesome_dog_ids}})\n            self.dump_collection('dog_houses', {\"dog_id\": {\"$in\": awesome_dog_ids}})\n\n\nYou can also use click's prompt function to make it dynamic, and prompt the use for input. Like so\n\n.. code:: python\n\n    from monarch import QuerySet\n    from click import echo, prompt\n    \n    class AccountQuerySet(QuerySet):\n    \n        def run(self):\n    \n            account_id = prompt('Please enter a account id', type=int)\n    \n            account_i_care_about = self.database.accounts.find({\"_id\": account_id})\n    \n            self.dump_collection('account', {\"_id\": account_id})\n            self.dump_collection('campaigns', {\"account_id\": account_i_care_about})\n\n\nThen to use them you can pass them into `copy_db` and `backup` with the --query-set options like so:\n\n.. code:: bash\n\n    copy_db production:development -q AccountQuerySet\n\n\n\nThe Installation\n----------------\n\n.. code:: bash\n\n    pip install monarch\n\n\nYou need to configure **monarch** for each project.  Simply run ``monarch init`` in the root of your project.  Then\ngo into `migrations.settings.py` to configure your environments and backups\n\n\nMigrations\n----------\n\nOne of the core design principals behind **monarch** is that it does not provide a DSL or DDL for database\nspecific migrations (like South and alembic)\n\nYou write your migrations in pure python using whatever libraries you like.\n\n\nWhen we develop a feature we implement the following:\n\n- the **feature**\n- the **tests**\n- and the necessary **migrations** that move the production data to where it needs to be to rock the new feature\n\nSo now with **monarch** we can implement a Pull Request(PR) with the feature, test and migration.\nAnd once your Continuous Integration says that your tests are cool then you can deploy and run\nthe pending migrations needed for your feature.\n\n\nExample Use Case\n----------------\n\n1) **Generate a Migration**\n\n.. code:: bash\n\n    monarch create add_indexes_to_user_table\n\nThat will create a template migration that looks something like this\n\n.. code:: python\n\n    # in ./migrations/_201405290038_add_indexes_to_user_table_migration.py\n\n    from monarch import MongoBackedMigration\n\n    class AddIndexesToUserTableMigration(MongoBackedMigration):\n\n        def run(self):\n            \"\"\"Write the code here that will migrate the database from one state to the next\n            No Need to handle exceptions -- we will take care of that for you\n            \"\"\"\n            raise NotImplementedError\n\n\n2) **Implement the Migration**\n\nDo whatever you want in that `run` method. I mean anything!  Go crazy wild man.\n\n3) **Test the Migration**\n\n.. code:: bash\n\n    # copy the production db locally\n    monarch copy_db production:development\n\n    # check the status of the pending migraitons\n    monarch list_migrations development\n\n    # try running the migrations\n    monarch migrate development\n\n    # everything cool?\n\n    # just to be sure -- lets make a backup\n    monarch backup production\n\n    # time to rock\n    monarch migrate production\n\n    # not cool?\n    # fix your migration and try again\n    monarch copy_db production:development\n\n    # and so on ....\n\n\nRoadMap\n-------\n* Support for PostgreSQL and the like\n* Use only pymongo (not mongoengine)\n",
    "docs_url": null,
    "download_url": "UNKNOWN",
    "downloads": {
      "last_day": 0,
      "last_month": 0,
      "last_week": 0
    },
    "home_page": "http://github.com/jtushman/monarch",
    "keywords": null,
    "license": "UNKNOWN",
    "maintainer": null,
    "maintainer_email": null,
    "name": "monarch",
    "platform": "UNKNOWN",
    "project_url": "https://pypi.org/project/monarch/",
    "release_url": "https://pypi.org/project/monarch/0.1.8/",
    "requires_python": null,
    "summary": "The un-migration migration tool",
    "version": "0.1.8"
  },
  "releases": {
    "0.0.1": [
      {
        "comment_text": "",
        "digests": {
          "md5": "7d5aaa4dfdf59103c6d14cbc9507ac09",
          "sha256": "9ad64fce9802147011d99d06459d5cc98af30627a6a060097ed20b7cc753020e"
        },
        "downloads": 1706,
        "filename": "monarch-0.0.1.tar.gz",
        "has_sig": false,
        "md5_digest": "7d5aaa4dfdf59103c6d14cbc9507ac09",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 1950,
        "upload_time": "2014-05-29T01:17:32",
        "url": "https://files.pythonhosted.org/packages/a5/45/2e6a9ad23d9c0697698b608c3040e43a4bca6514f98669697a9e03e2cf42/monarch-0.0.1.tar.gz"
      }
    ],
    "0.0.2": [
      {
        "comment_text": "",
        "digests": {
          "md5": "1f1fae3186ce8d5c84bcfdbdd54b765f",
          "sha256": "1aadd3ed049fadfb9276ea81c0e4f0f9058012b60123b8fb26f2089ea5ab5769"
        },
        "downloads": 1636,
        "filename": "monarch-0.0.2.tar.gz",
        "has_sig": false,
        "md5_digest": "1f1fae3186ce8d5c84bcfdbdd54b765f",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 2236,
        "upload_time": "2014-06-12T18:32:23",
        "url": "https://files.pythonhosted.org/packages/a2/46/175fe985ed5413d513af221b3d9a44d331fa7a1431cb25c1428c8c51b05d/monarch-0.0.2.tar.gz"
      }
    ],
    "0.0.3": [
      {
        "comment_text": "",
        "digests": {
          "md5": "aa371c4d19069aa0cc210210b5dd3a64",
          "sha256": "9085bcd1c8c9c9ae2a94185722e716edbd9363d2e24751f4a7ad0e10d355b7f0"
        },
        "downloads": 1629,
        "filename": "monarch-0.0.3.tar.gz",
        "has_sig": false,
        "md5_digest": "aa371c4d19069aa0cc210210b5dd3a64",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 5768,
        "upload_time": "2014-06-12T18:40:04",
        "url": "https://files.pythonhosted.org/packages/0d/2a/666776effa3d7ff19bca20ed51bd1f5be90e5b32630c53074b4f471fa1f5/monarch-0.0.3.tar.gz"
      }
    ],
    "0.0.4": [
      {
        "comment_text": "",
        "digests": {
          "md5": "6304d727f8589db2bb5380e679028097",
          "sha256": "4a2d27f96197d87f87b977ec30b67fd14bdd4e0272aa303f6ed4f8ed411bff51"
        },
        "downloads": 1656,
        "filename": "monarch-0.0.4.tar.gz",
        "has_sig": false,
        "md5_digest": "6304d727f8589db2bb5380e679028097",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 7087,
        "upload_time": "2014-06-12T18:41:43",
        "url": "https://files.pythonhosted.org/packages/72/02/90d721a2c9360f6207581c20d30e216dd9df7a4c5affd94e9b73ab3e35f0/monarch-0.0.4.tar.gz"
      }
    ],
    "0.0.5": [
      {
        "comment_text": "",
        "digests": {
          "md5": "696eeddf8a61554ff8f3c4e2bce492ef",
          "sha256": "446996ad0e93e8186d371bb9eaed2989e2ff29cfea11a6a16500568cca413cb5"
        },
        "downloads": 2048,
        "filename": "monarch-0.0.5.tar.gz",
        "has_sig": false,
        "md5_digest": "696eeddf8a61554ff8f3c4e2bce492ef",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 9119,
        "upload_time": "2014-06-18T20:14:51",
        "url": "https://files.pythonhosted.org/packages/c6/87/31d8eb7e8462039b7a2cdb2a31faddc6a092555bfb1631ce876f37e80dec/monarch-0.0.5.tar.gz"
      }
    ],
    "0.0.6": [
      {
        "comment_text": "",
        "digests": {
          "md5": "ba70eaa6134fa9f1d5b3eb4f67a7a94e",
          "sha256": "cc6197cc8656b1c915a82eed2eb4c4d4fe2cb713a409a70ca96920c9cae152ed"
        },
        "downloads": 1628,
        "filename": "monarch-0.0.6.tar.gz",
        "has_sig": false,
        "md5_digest": "ba70eaa6134fa9f1d5b3eb4f67a7a94e",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 9227,
        "upload_time": "2014-06-19T13:59:59",
        "url": "https://files.pythonhosted.org/packages/b0/a9/bfe9d9a2bde6272db9232561563b2437c3c82c1e1b2c06825cdd301559f5/monarch-0.0.6.tar.gz"
      }
    ],
    "0.0.7": [
      {
        "comment_text": "",
        "digests": {
          "md5": "30be14cefd9aeaa1aeba3461afe5ebd4",
          "sha256": "c28714a57f5c6e4d555e49826a3e701426b5d089f1601adbb88f81839f5db5f2"
        },
        "downloads": 1595,
        "filename": "monarch-0.0.7.tar.gz",
        "has_sig": false,
        "md5_digest": "30be14cefd9aeaa1aeba3461afe5ebd4",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 9715,
        "upload_time": "2014-06-25T19:16:30",
        "url": "https://files.pythonhosted.org/packages/7d/43/8c21efc8b744bf6c0fc1d70fdb5c1c61f0cfedf72968cabd19b309e4f20b/monarch-0.0.7.tar.gz"
      }
    ],
    "0.0.8": [
      {
        "comment_text": "",
        "digests": {
          "md5": "dda422b388bb7a8a36148399e4c79f88",
          "sha256": "a4bf4a1dcebc88eb9551db9f824a0a633022a1f154abf7d7479607351c97188e"
        },
        "downloads": 1613,
        "filename": "monarch-0.0.8.tar.gz",
        "has_sig": false,
        "md5_digest": "dda422b388bb7a8a36148399e4c79f88",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 9942,
        "upload_time": "2014-06-30T12:02:53",
        "url": "https://files.pythonhosted.org/packages/f4/5d/bffbe334ff1f25ab42d192f8cd57028bfb06b40ca5f1b11ff26b4431a8cd/monarch-0.0.8.tar.gz"
      }
    ],
    "0.0.9": [
      {
        "comment_text": "",
        "digests": {
          "md5": "1030dd15950ae105ab68ae8fd6e1966d",
          "sha256": "b12f279963e2220393443922656058d280edc7f431439bb7da9737cbaf072038"
        },
        "downloads": 1583,
        "filename": "monarch-0.0.9.tar.gz",
        "has_sig": false,
        "md5_digest": "1030dd15950ae105ab68ae8fd6e1966d",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 9973,
        "upload_time": "2014-07-03T18:05:30",
        "url": "https://files.pythonhosted.org/packages/74/88/b9b09acf42e87b07a0ece8c5a4215e8d3bd6b83a31ab17b277f1d3236dd9/monarch-0.0.9.tar.gz"
      }
    ],
    "0.1.0": [
      {
        "comment_text": "",
        "digests": {
          "md5": "277bfc9004bf2f08ccbca55e3409462e",
          "sha256": "eaa0c0c69964ccea0f3c252f3c19108d2e8add8ec19863ff9d62d9046a72ccab"
        },
        "downloads": 1546,
        "filename": "monarch-0.1.0.tar.gz",
        "has_sig": false,
        "md5_digest": "277bfc9004bf2f08ccbca55e3409462e",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 10113,
        "upload_time": "2014-07-21T18:48:55",
        "url": "https://files.pythonhosted.org/packages/2a/79/5c0ffcf15b4cd480596a5d345065b2f2db0817e4c5a10663a8751e553fc8/monarch-0.1.0.tar.gz"
      }
    ],
    "0.1.1": [
      {
        "comment_text": "",
        "digests": {
          "md5": "73795814359078142a049cc9d0428946",
          "sha256": "f92c3c4da4f4e43bda9ae4a416fedf267f5e3ff5977a6802dfc23d58685266f7"
        },
        "downloads": 1504,
        "filename": "monarch-0.1.1.tar.gz",
        "has_sig": false,
        "md5_digest": "73795814359078142a049cc9d0428946",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 10258,
        "upload_time": "2014-07-25T17:07:47",
        "url": "https://files.pythonhosted.org/packages/31/d3/a549b1e34d33c24942857b2c317694010723341d1399bde32335abc90587/monarch-0.1.1.tar.gz"
      }
    ],
    "0.1.2": [
      {
        "comment_text": "",
        "digests": {
          "md5": "4d7264b9c8043b168899f7426afb13bb",
          "sha256": "a1bca24fdd0f48f1568237211b2cfb12c2da7e6e5c7c3319588e72d621a47087"
        },
        "downloads": 1481,
        "filename": "monarch-0.1.2.tar.gz",
        "has_sig": false,
        "md5_digest": "4d7264b9c8043b168899f7426afb13bb",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 10498,
        "upload_time": "2014-07-29T12:56:35",
        "url": "https://files.pythonhosted.org/packages/2b/c8/f95877c9438efdc4f53d699f4287edb54ee1b845ad4d5aab160b91f9d559/monarch-0.1.2.tar.gz"
      }
    ],
    "0.1.3": [
      {
        "comment_text": "",
        "digests": {
          "md5": "6b81c1ac436a585fd74eeca11653b169",
          "sha256": "ef53848e5e562813d00918f7cb968c103c8036b98fbce7032c8caaba9c8d8925"
        },
        "downloads": 1664,
        "filename": "monarch-0.1.3.tar.gz",
        "has_sig": false,
        "md5_digest": "6b81c1ac436a585fd74eeca11653b169",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 10945,
        "upload_time": "2014-07-29T18:43:55",
        "url": "https://files.pythonhosted.org/packages/fc/00/76ecfba17a25ca814e8c9f68b961ec5b6f4bd83c47e1bbc792944632f36e/monarch-0.1.3.tar.gz"
      }
    ],
    "0.1.5": [
      {
        "comment_text": "",
        "digests": {
          "md5": "624f669bcf5f1b411a6ae6e7f36560c4",
          "sha256": "0db8c2ddbc1fa40288024aef50ecac756eb1fb40e1c8314b810fd56065329bf2"
        },
        "downloads": 1257,
        "filename": "monarch-0.1.5.tar.gz",
        "has_sig": false,
        "md5_digest": "624f669bcf5f1b411a6ae6e7f36560c4",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 12560,
        "upload_time": "2014-11-21T00:33:54",
        "url": "https://files.pythonhosted.org/packages/92/e8/74f3c358ae6b1d8ce14f8527c79d74712b35315e361065338c2894ad4cf6/monarch-0.1.5.tar.gz"
      }
    ],
    "0.1.6": [
      {
        "comment_text": "",
        "digests": {
          "md5": "c0d3f79267a864566dd7a2d1a667a76f",
          "sha256": "f42cc53442f91d8db182013297156477d4aa308e8a47f83934e1ad5eabfcc1b3"
        },
        "downloads": 1239,
        "filename": "monarch-0.1.6.tar.gz",
        "has_sig": false,
        "md5_digest": "c0d3f79267a864566dd7a2d1a667a76f",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 12573,
        "upload_time": "2014-11-21T17:07:51",
        "url": "https://files.pythonhosted.org/packages/de/9d/713e3fd4d8a086f43943fe45fdf1823f0543bc21360a18df81d304550ae2/monarch-0.1.6.tar.gz"
      }
    ],
    "0.1.7": [
      {
        "comment_text": "",
        "digests": {
          "md5": "eedb0372c58230294cdc903c4080bb70",
          "sha256": "48ee2a1c521b9b4cdf8e1208994b48b70caff120596c5b8c2b0432908c1fe5b3"
        },
        "downloads": 1237,
        "filename": "monarch-0.1.7.tar.gz",
        "has_sig": false,
        "md5_digest": "eedb0372c58230294cdc903c4080bb70",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 12672,
        "upload_time": "2014-11-24T15:15:43",
        "url": "https://files.pythonhosted.org/packages/9f/b6/c2f973f4e208b4e9ffa9585fe50d690cd5f4ebaa7bff237b805a6dbb7802/monarch-0.1.7.tar.gz"
      }
    ],
    "0.1.8": [
      {
        "comment_text": "",
        "digests": {
          "md5": "0b595770870994649dbd083d618d06bb",
          "sha256": "8e72c18a3dc585b513d921bae11712166dec133e6858c27e6125adfccd4f278b"
        },
        "downloads": 1349,
        "filename": "monarch-0.1.8.tar.gz",
        "has_sig": false,
        "md5_digest": "0b595770870994649dbd083d618d06bb",
        "packagetype": "sdist",
        "python_version": "source",
        "size": 12685,
        "upload_time": "2014-12-03T16:16:30",
        "url": "https://files.pythonhosted.org/packages/be/f5/a962b78703b5af9be1f02606b586c47c6fd6ac7ce54f0539eb013880faa0/monarch-0.1.8.tar.gz"
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "md5": "0b595770870994649dbd083d618d06bb",
        "sha256": "8e72c18a3dc585b513d921bae11712166dec133e6858c27e6125adfccd4f278b"
      },
      "downloads": 1349,
      "filename": "monarch-0.1.8.tar.gz",
      "has_sig": false,
      "md5_digest": "0b595770870994649dbd083d618d06bb",
      "packagetype": "sdist",
      "python_version": "source",
      "size": 12685,
      "upload_time": "2014-12-03T16:16:30",
      "url": "https://files.pythonhosted.org/packages/be/f5/a962b78703b5af9be1f02606b586c47c6fd6ac7ce54f0539eb013880faa0/monarch-0.1.8.tar.gz"
    }
  ]
}